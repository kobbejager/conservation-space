FROM docker-reg.sirmaplatform.com/nginx:1.12.2-u5

ENV \
	NGINX_SERVER_NAME="_" \
	NGINX_SSL_PROTOCOLS="TLSv1 TLSv1.1 TLSv1.2" \
	NGINX_SSL_CIPHERS="ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS" \
	NGINX_MAX_REQUEST_SIZE="2000M" \
	NGINX_PROXY_TIMEOUT="3600" \
	GZIP_ENABLED="on" \
	PROXY_LOG_LEVEL="DEBUG"

COPY rootfs/ /

RUN \
	sed 's|application/font-woff                 woff;|application/font-woff                 woff;\n    application/font-woff2                woff2;|g' -i /etc/nginx/mime.types && \
	chmod +x /usr/local/bin/http-proxy-linux-amd64

EXPOSE 8080
